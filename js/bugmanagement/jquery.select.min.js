/**
 * Created by chenyou on 16/3/29.
 */
+function($){
    var def ={
        ul:'.testin-select-list',
        p:'.testin-select-set'
    };
    $.fn.testinSelect = function(options){
        var opts = $.extend({},def,typeof(options)==='string'?{}:options);
        return $(this).each(function(){
            var $this = $(this),
                ul = $(this).find(opts.ul),
                p = $(this).find(opts.p),
                data = $(this).data('select.testin.init');
            if(data){
                return;
            }
            $(this).on('click','.testin-select-set',function(e) {
                $(document).trigger('click.testin.select.hide');
                ul.slideToggle(function(){
                    $this.toggleClass('testin-select-open',$(this).is(':visible'));
                });
                e.stopPropagation();
            }).addClass('visibility-h').removeClass('visibility-h');
            ul.on('click','li',function(){
                var text=$(this).text(),
                    value = $(this).attr('value');
                p.attr('value',value).text(text).removeClass("select");
                $this.trigger('change.testin.select',[value,text]);
            });
            ul.find('li[selected]').trigger('click');
            $(this).data('select.testin.init',true);
        });
    };
    $(document).on('click.testin.select.hide',function(){
        $(this).find(def.ul).slideUp(function(){
            $(this).parent('.testin-select').removeClass('testin-select-open');
        });
    });
    $(function(){
        $('.testin-select:not([disabled],.disabled)').testinSelect();
    });
    window.$t = $;
}(jQuery);